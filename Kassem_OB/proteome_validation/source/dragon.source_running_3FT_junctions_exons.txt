#!/bin/bash

# language: timepoint = timepoint. replicate = technical replicate.

source_dir="/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/proteome_validation/source/"
junction_3FT_tool_path="/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/proteome_validation/source/three_frame_translate_junctions_ORF.based.R"
exon_3FT_tool_path="/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/analysis_NMD_classifier/source/poison_exon_finder.R"
results_dir="/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/proteome_validation/results_database_generation/"
mkdir -p $results_dir

reference_genome_dir="/mnt/Tertiary/sharedfolder/hg38_ensembl_reference/raw_genome_fasta/dna_by_chr/"

# JUM junctions - differential
Rscript $junction_3FT_tool_path -J "/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/analysis_JUM/run_2_PGNEXUS_OBseries_readlength100/R_processing_results/wide_table_of_983_differential_VSRs_qvalue0.01_dPSI0.15_with_na_constituent_junctions.txt" -I intron_retention --source_tag "JUM_differential" -G "/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/analysis_strawberry/results_assemblyonly/merged/GRAND_OBseries_ref_denovo_reconstructed_stringtiemerged.gtf" -R $reference_genome_dir -U 50 -D 50 -T "JUM_junctions_differential_3FT" -O $results_dir --chrmode 1 --ncores 16x8 2>&1 | tee $results_dir"JUM_junctions_differential_3FT.log"

# JUM junctions - constitutive
Rscript $junction_3FT_tool_path -J "/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/analysis_JUM/run_2_PGNEXUS_OBseries_readlength100/R_processing_results/wide_table_of_7913_constitutive_VSRs_qvalue0.01_dPSI0.15_no_na_constituent_junctions.txt" -I intron_retention --source_tag "JUM_constitutive" -G "/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/analysis_strawberry/results_assemblyonly/merged/GRAND_OBseries_ref_denovo_reconstructed_stringtiemerged.gtf" -R $reference_genome_dir -U 50 -D 50 -T "JUM_junctions_constitutive_3FT" -O $results_dir --chrmode 1 --ncores 8x8 2>&1 | tee $results_dir"JUM_junctions_constitutive_3FT.log"

# PSI-Sigma exons - differential
Rscript $exon_3FT_tool_path \
--exon_table_path "/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/analysis_PSIsigma/results/run_1.9g_in_parallel_with_denominator_sorted_GTF/R_processing_results/long_tibble_of_psisigma_allcomparisons_differential_exons1810_dpsi15_DEXSeq_padj0.01_anysig_with_na_poison_exon_finder_3FT.txt" \
--intron_retention_string "IR" \
--source_tag "PSISigma_differential" \
--reference_transcript_gtf "/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/analysis_strawberry/results_assemblyonly/merged/GRAND_OBseries_ref_denovo_reconstructed_stringtiemerged.gtf" \
--reference_genome_fasta_dir $reference_genome_dir \
--output_dir $results_dir \
--output_name "PSISigma_differential_3FT" \
--ncores 32 \
--use_start_codon "YES" \
--output_fasta TRUE \
--chrmode 1 \
--save_workspace_when_done "YES" | tee $results_dir"PSISigma_differential_3FT.log"

# PSI-Sigma exons - constitutive
Rscript $exon_3FT_tool_path \
--exon_table_path "/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/analysis_PSIsigma/results/run_1.9g_in_parallel_with_denominator_sorted_GTF/R_processing_results/long_table_of_all_constitutive_LIV7532_dpsi15_DEXSeq_padj0.01_poison_exon_finder_3FT.txt" \
--intron_retention_string "IR" \
--source_tag "PSISigma_constitutive" \
--reference_transcript_gtf "/mnt/Tertiary/sharedfolder/PGNEXUS_kassem_MSC/Kassem_OB/analysis_strawberry/results_assemblyonly/merged/GRAND_OBseries_ref_denovo_reconstructed_stringtiemerged.gtf" \
--reference_genome_fasta_dir $reference_genome_dir \
--output_dir $results_dir \
--output_name "PSISigma_constitutive_3FT" \
--ncores 8 \
--use_start_codon "YES" \
--output_fasta TRUE \
--chrmode 1 \
--save_workspace_when_done "YES" | tee $results_dir"PSISigma_constitutive_3FT.log"
